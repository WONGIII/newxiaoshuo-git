# ç¬”è®°åŠŸèƒ½å®ç°æ€»ç»“

## é¡¹ç›®æ¦‚è¿°

æˆåŠŸä¸ºå°è¯´ç½‘ç«™é›†æˆäº†ä¸€ä¸ªç±»ä¼¼Notionçš„ç¬”è®°åŠŸèƒ½ï¼Œä¸“é—¨ç”¨äºå°è¯´ç« èŠ‚çš„è‰ç¨¿åˆ›ä½œå’Œç®¡ç†ã€‚è¯¥åŠŸèƒ½æä¾›äº†ä¼˜é›…çš„ç•Œé¢è®¾è®¡å’Œå¼ºå¤§çš„AIè¾…åŠ©å†™ä½œèƒ½åŠ›ã€‚

## å®ç°çš„åŠŸèƒ½ç‰¹æ€§

### ğŸ¯ æ ¸å¿ƒåŠŸèƒ½
1. **å®æ—¶è‡ªåŠ¨ä¿å­˜**
   - æ¯è¾“å…¥ä¸€ä¸ªå­—ç¬¦è‡ªåŠ¨ä¿å­˜åˆ°SQLiteæ•°æ®åº“
   - é˜²æŠ–æœºåˆ¶é¿å…é¢‘ç¹è¯·æ±‚
   - å®æ—¶æ˜¾ç¤ºä¿å­˜çŠ¶æ€

2. **Markdownç¼–è¾‘å™¨**
   - æ”¯æŒç²—ä½“ã€æ–œä½“ã€åˆ—è¡¨ç­‰åŸºæœ¬æ ¼å¼
   - å¯Œæ–‡æœ¬ç¼–è¾‘ä½“éªŒ
   - é”®ç›˜å¿«æ·é”®æ”¯æŒ

3. **AIå†™ä½œåŠ©æ‰‹**
   - æ”¯æŒOpenAIå…¼å®¹APIæ ¼å¼
   - å¯é…ç½®APIåœ°å€ã€å¯†é’¥å’Œæ¨¡å‹
   - å®æ—¶AIè¾…åŠ©åˆ›ä½œ

4. **è‰ç¨¿ç®¡ç†**
   - æ¯æœ¬å°è¯´ç‹¬ç«‹çš„è‰ç¨¿ç©ºé—´
   - è‰ç¨¿åˆ—è¡¨å’ŒçŠ¶æ€ç®¡ç†
   - ä¸€é”®å‘å¸ƒä¸ºæ­£å¼ç« èŠ‚

### ğŸ¨ è®¾è®¡ç‰¹è‰²
- **æ¯›ç»ç’ƒæ•ˆæœ** - ä½¿ç”¨backdrop-filterå®ç°ç°ä»£UI
- **ä¼˜é›…æ¸å˜** - ç²¾å¿ƒè®¾è®¡çš„é…è‰²æ–¹æ¡ˆ
- **å“åº”å¼å¸ƒå±€** - é€‚é…æ¡Œé¢å’Œç§»åŠ¨è®¾å¤‡
- **èˆ’é€‚äº¤äº’** - æµç•…çš„åŠ¨ç”»å’Œè¿‡æ¸¡æ•ˆæœ

## æŠ€æœ¯æ¶æ„

### åç«¯å®ç°
```python
# æ–°å¢æ•°æ®æ¨¡å‹
class Draft(db.Model):
    id = db.Column(db.Integer, primary_key=True)
    title = db.Column(db.String(200), nullable=False, default="æ— æ ‡é¢˜è‰ç¨¿")
    content = db.Column(db.Text, default="")
    novel_id = db.Column(db.Integer, db.ForeignKey("novel.id"), nullable=False)
    user_id = db.Column(db.Integer, db.ForeignKey("user.id"), nullable=False)
    is_published = db.Column(db.Boolean, default=False)
    chapter_number = db.Column(db.Integer, nullable=True)

class UserSettings(db.Model):
    id = db.Column(db.Integer, primary_key=True)
    user_id = db.Column(db.Integer, db.ForeignKey("user.id"), nullable=False, unique=True)
    openai_api_key = db.Column(db.String(255), nullable=True)
    openai_base_url = db.Column(db.String(500), nullable=True)
    openai_model = db.Column(db.String(100), nullable=True)
```

### å‰ç«¯å®ç°
- **ç¼–è¾‘å™¨ç•Œé¢** - åŸºäºcontenteditableçš„å¯Œæ–‡æœ¬ç¼–è¾‘å™¨
- **è‡ªåŠ¨ä¿å­˜** - JavaScriptå®šæ—¶å™¨å’Œé˜²æŠ–æœºåˆ¶
- **AIäº¤äº’** - æ¨¡æ€æ¡†å’Œå®æ—¶APIè°ƒç”¨
- **æ ·å¼è®¾è®¡** - ç°ä»£åŒ–çš„CSS Gridå’ŒFlexboxå¸ƒå±€

## APIç«¯ç‚¹

### è‰ç¨¿ç®¡ç†
- `GET /author/novel/<novel_id>/drafts` - è‰ç¨¿åˆ—è¡¨
- `GET /author/novel/<novel_id>/draft/new` - åˆ›å»ºè‰ç¨¿
- `GET /author/draft/<draft_id>` - ç¼–è¾‘è‰ç¨¿
- `POST /author/draft/<draft_id>/save` - ä¿å­˜è‰ç¨¿
- `POST /author/draft/<draft_id>/publish` - å‘å¸ƒè‰ç¨¿
- `POST /author/draft/<draft_id>/delete` - åˆ é™¤è‰ç¨¿

### AIåŠŸèƒ½
- `GET /author/settings` - ç”¨æˆ·è®¾ç½®é¡µé¢
- `POST /author/settings` - ä¿å­˜AIè®¾ç½®
- `POST /author/ai/assist` - AIåŠ©æ‰‹API

## æ–‡ä»¶ç»“æ„

```
newxiaoshuo/
â”œâ”€â”€ app.py                    # æ–°å¢ç¬”è®°åŠŸèƒ½è·¯ç”±
â”œâ”€â”€ models.py                 # æ–°å¢Draftå’ŒUserSettingsæ¨¡å‹
â”œâ”€â”€ templates/
â”‚   â”œâ”€â”€ drafts_list.html      # è‰ç¨¿åˆ—è¡¨é¡µé¢
â”‚   â”œâ”€â”€ draft_editor.html     # è‰ç¨¿ç¼–è¾‘å™¨
â”‚   â””â”€â”€ user_settings.html    # AIè®¾ç½®é¡µé¢
â”œâ”€â”€ static/
â”‚   â”œâ”€â”€ css/style.css         # æ–°å¢ç¬”è®°ç›¸å…³æ ·å¼
â”‚   â””â”€â”€ js/draft_editor.js    # ç¼–è¾‘å™¨JavaScripté€»è¾‘
â””â”€â”€ requirements.txt          # æ–°å¢openaiä¾èµ–
```

## æŠ€æœ¯äº®ç‚¹

### 1. ä¼˜é›…çš„è‡ªåŠ¨ä¿å­˜
```javascript
function autoSave() {
    // é˜²æŠ–æœºåˆ¶é¿å…é¢‘ç¹è¯·æ±‚
    clearTimeout(saveTimeout);
    saveTimeout = setTimeout(() => {
        // å®æ—¶ä¿å­˜åˆ°åç«¯
        fetch(`/author/draft/${draftId}/save`, {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify(data)
        })
    }, 1000);
}
```

### 2. çµæ´»çš„AIé›†æˆ
```python
# æ”¯æŒå¤šç§OpenAIå…¼å®¹API
client = OpenAI(
    api_key=user_settings.openai_api_key,
    base_url=user_settings.openai_base_url or "https://api.openai.com/v1"
)
```

### 3. ç°ä»£åŒ–çš„UIè®¾è®¡
- æ¯›ç»ç’ƒèƒŒæ™¯æ•ˆæœ
- æµç•…çš„åŠ¨ç”»è¿‡æ¸¡
- å“åº”å¼ç½‘æ ¼å¸ƒå±€
- ä¼˜é›…çš„è‰²å½©æ­é…

## ç”¨æˆ·ä½“éªŒ

### åˆ›ä½œæµç¨‹
1. **é…ç½®è®¾ç½®** â†’ å¡«å†™AI APIä¿¡æ¯
2. **åˆ›å»ºè‰ç¨¿** â†’ è¿›å…¥ç¼–è¾‘å™¨ç•Œé¢
3. **å®æ—¶åˆ›ä½œ** â†’ è‡ªåŠ¨ä¿å­˜ï¼ŒAIè¾…åŠ©
4. **å‘å¸ƒç« èŠ‚** â†’ ä¸€é”®è½¬ä¸ºæ­£å¼å†…å®¹

### ç•Œé¢ç‰¹è‰²
- ç›´è§‚çš„å·¥å…·æ å’ŒçŠ¶æ€æ˜¾ç¤º
- æ¸…æ™°çš„è‰ç¨¿çŠ¶æ€æ ‡è¯†
- å‹å¥½çš„ç©ºçŠ¶æ€æç¤º
- ä¾¿æ·çš„å¯¼èˆªå’Œæ“ä½œ

## å…¼å®¹æ€§

### æ”¯æŒçš„APIæä¾›å•†
- DeepSeek API
- OpenAIå®˜æ–¹API
- å…¶ä»–OpenAIå…¼å®¹æœåŠ¡

### æµè§ˆå™¨æ”¯æŒ
- Chrome 90+
- Firefox 88+
- Safari 14+
- Edge 90+

## å®‰å…¨è€ƒè™‘

1. **APIå¯†é’¥å®‰å…¨** - å­˜å‚¨åœ¨ç”¨æˆ·ç‹¬ç«‹çš„è®¾ç½®ä¸­
2. **æƒé™æ§åˆ¶** - ç”¨æˆ·åªèƒ½è®¿é—®è‡ªå·±çš„è‰ç¨¿
3. **è¾“å…¥éªŒè¯** - åç«¯éªŒè¯æ‰€æœ‰ç”¨æˆ·è¾“å…¥
4. **XSSé˜²æŠ¤** - å†…å®¹å®‰å…¨ç­–ç•¥å’Œè¾“å…¥æ¸…ç†

## æ€§èƒ½ä¼˜åŒ–

1. **æ•°æ®åº“ç´¢å¼•** - ä¼˜åŒ–æŸ¥è¯¢æ€§èƒ½
2. **é˜²æŠ–æœºåˆ¶** - å‡å°‘ä¸å¿…è¦çš„è¯·æ±‚
3. **æ‡’åŠ è½½** - æŒ‰éœ€åŠ è½½èµ„æº
4. **ç¼“å­˜ç­–ç•¥** - æµè§ˆå™¨ç¼“å­˜ä¼˜åŒ–

## éƒ¨ç½²è¯´æ˜

### ä¾èµ–å®‰è£…
```bash
pip install -r requirements.txt
```

### æ•°æ®åº“è¿ç§»
```python
with app.app_context():
    db.create_all()  # è‡ªåŠ¨åˆ›å»ºæ–°è¡¨
```

### å¯åŠ¨åº”ç”¨
```bash
python app.py
```

## æ€»ç»“

è¯¥ç¬”è®°åŠŸèƒ½æˆåŠŸå®ç°äº†ï¼š
- âœ… ç±»ä¼¼Notionçš„ä¼˜é›…ç¼–è¾‘ä½“éªŒ
- âœ… å®æ—¶è‡ªåŠ¨ä¿å­˜æœºåˆ¶
- âœ… AIè¾…åŠ©å†™ä½œèƒ½åŠ›
- âœ… ç²¾ç¾çš„æ¯›ç»ç’ƒè®¾è®¡
- âœ… å®Œæ•´çš„è‰ç¨¿ç®¡ç†æµç¨‹
- âœ… çµæ´»çš„APIé…ç½®æ”¯æŒ

ä¸ºå°è¯´åˆ›ä½œè€…æä¾›äº†ä¸€ä¸ªä¸“ä¸šã€èˆ’é€‚ä¸”åŠŸèƒ½å¼ºå¤§çš„å†™ä½œç¯å¢ƒï¼Œæ˜¾è‘—æå‡äº†åˆ›ä½œæ•ˆç‡å’Œä½“éªŒã€‚